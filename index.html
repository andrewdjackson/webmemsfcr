<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
</head>
<body>
<button onclick="connect()">Connect</button>
<button onclick="disconnect()">Disconnect</button>
<button onclick="getdataframe()">Dataframe</button>
<span><input id="command"><button onclick="sendCommand()">Send</button></span>

<script type="module">
	//import { MemsSerialInterface } from "./static/scripts/rosco/mems-serial.js"
	import {MemsEcu16} from "./static/scripts/rosco/mems-ecu16.js";
	import {EventTopic, EventQueue} from "./static/scripts/rosco/mems-queue.js";

	var q = new EventQueue();
	q.subscribe(EventTopic.Dataframe, dataframeReceived);

	var e = new MemsEcu16(q);

	window.connect=()=> {
		e.Connect()
			.then((result) => {
				console.log(`index.html: connect ${result}`);
			})
			.catch((error) => {
				console.error(`index.html: connect ${error}`);
			});
	}

	window.disconnect=()=> {
		e.Stop();

		e.Disconnect()
			.then((result) => {
					console.log(`index.html: disconnected (connected ${result})`);
			})
			.catch((error) => {
				console.error(`index.html: disconnect ${error}`);
			});
	}

	window.getdataframe=()=> {
		e.Start();
	}

	window.sendCommand=()=> {
		let command = parseInt(document.getElementById("command").value, 16);

		e.SendAndReceive(command, 100);
	}

	function dataframeReceived(data) {
		console.log(`subscriber received ${JSON.stringify(data)}`);
	}
</script>
</body>
</html>
